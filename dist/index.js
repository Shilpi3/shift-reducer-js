"use strict";

exports["default"] = reduce;
/**
 * Copyright 2014 Shape Security, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License")
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

var MonoidalReducer = require("./monoidal-reducer")["default"];
exports.MonoidalReducer = MonoidalReducer;



function recurse(branch) {
  return function (reducer, node) {
    var branchNode = node[branch];
    return DRIVER[branchNode.type](reducer, branchNode);
  };
}

function recurseMaybe(branch) {
  return function (reducer, node) {
    var branchNode = node[branch];
    if (branchNode == null) return null;
    return DRIVER[branchNode.type](reducer, branchNode);
  };
}

function recurseList(branch) {
  return function (reducer, node) {
    return [].map.call(node[branch], function (n) {
      return DRIVER[n.type](reducer, n);
    });
  };
}

function recurseListMaybe(branch) {
  return function (reducer, node) {
    return [].map.call(node[branch], function (n) {
      if (n == null) return null;
      return DRIVER[n.type](reducer, n);
    });
  };
}

var REDUCER_SPEC = {
  ArrayExpression: [recurseListMaybe("elements")],
  AssignmentExpression: [recurse("binding"), recurse("expression")],
  BinaryExpression: [recurse("left"), recurse("right")],
  Block: [recurseList("statements")],
  BlockStatement: [recurse("block")],
  BreakStatement: [recurseMaybe("label")],
  CallExpression: [recurse("callee"), recurseList("arguments")],
  CatchClause: [recurse("binding"), recurse("body")],
  ComputedMemberExpression: [recurse("object"), recurse("expression")],
  ConditionalExpression: [recurse("test"), recurse("consequent"), recurse("alternate")],
  ContinueStatement: [recurseMaybe("label")],
  DataProperty: [recurse("name"), recurse("expression")],
  DebuggerStatement: [],
  DoWhileStatement: [recurse("body"), recurse("test")],
  EmptyStatement: [],
  ExpressionStatement: [recurse("expression")],
  ForInStatement: [recurse("left"), recurse("right"), recurse("body")],
  ForStatement: [recurseMaybe("init"), recurseMaybe("test"), recurseMaybe("update"), recurse("body")],
  FunctionBody: [recurseList("directives"), recurseList("statements")],
  FunctionDeclaration: [recurse("name"), recurseList("parameters"), recurse("body")],
  FunctionExpression: [recurseMaybe("name"), recurseList("parameters"), recurse("body")],
  Getter: [recurse("name"), recurse("body")],
  Identifier: [],
  IdentifierExpression: [recurse("identifier")],
  IfStatement: [recurse("test"), recurse("consequent"), recurseMaybe("alternate")],
  LabeledStatement: [recurse("label"), recurse("body")],
  LiteralBooleanExpression: [],
  LiteralNullExpression: [],
  LiteralInfinityExpression: [],
  LiteralNumericExpression: [],
  LiteralRegExpExpression: [],
  LiteralStringExpression: [],
  NewExpression: [recurse("callee"), recurseList("arguments")],
  ObjectExpression: [recurseList("properties")],
  PostfixExpression: [recurse("operand")],
  PrefixExpression: [recurse("operand")],
  PropertyName: [],
  ReturnStatement: [recurseMaybe("expression")],
  Script: [recurse("body")],
  Setter: [recurse("name"), recurse("parameter"), recurse("body")],
  StaticMemberExpression: [recurse("object"), recurse("property")],
  SwitchCase: [recurse("test"), recurseList("consequent")],
  SwitchDefault: [recurseList("consequent")],
  SwitchStatement: [recurse("discriminant"), recurseList("cases")],
  SwitchStatementWithDefault: [recurse("discriminant"), recurseList("preDefaultCases"), recurse("defaultCase"), recurseList("postDefaultCases")],
  ThisExpression: [],
  ThrowStatement: [recurse("expression")],
  TryCatchStatement: [recurse("body"), recurse("catchClause")],
  TryFinallyStatement: [recurse("body"), recurseMaybe("catchClause"), recurse("finalizer")],
  UnknownDirective: [],
  UseStrictDirective: [],
  VariableDeclaration: [recurseList("declarators")],
  VariableDeclarationStatement: [recurse("declaration")],
  VariableDeclarator: [recurse("binding"), recurseMaybe("init")],
  WhileStatement: [recurse("test"), recurse("body")],
  WithStatement: [recurse("object"), recurse("body")] };

var DRIVER = (function () {
  var o = Object.create(null);
  for (var T in REDUCER_SPEC) {
    var _ret = (function (T) {
      if (!({}).hasOwnProperty.call(REDUCER_SPEC, T)) return "continue";
      var reducingFunctionName = "reduce" + T;
      o[T] = function (reducer, node) {
        return reducer[reducingFunctionName].apply(reducer, [node].concat(REDUCER_SPEC[T].map(function (f) {
          return f(reducer, node);
        })));
      };
    })(T);

    if (_ret === "continue") continue;
  }
  return o;
})();


function reduce(reducer, reducible) {
  return DRIVER[reducible.type](reducer, reducible);
}
//# sourceMappingURL=data:application/json;base64,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QUFDLElBQUksQ0FBQyxDQUFDO0FBQzVCLE9BQUksSUFBSSxDQUFDLElBQUksWUFBWSxFQUFFOzBCQUFuQixDQUFDO0FBQ1AsVUFBRyxDQUFDLENBQUEsR0FBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxFQUFFLGtCQUFTO0FBQ3RELFVBQUksb0JBQW9CLEdBQUcsUUFBUSxHQUFHLENBQUMsQ0FBQztBQUN4QyxPQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBUyxPQUFPLEVBQUUsSUFBSSxFQUFFO0FBQzdCLGVBQU8sT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FDL0QsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLENBQUM7aUJBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUM7U0FBQSxDQUFDLENBQzdDLENBQUMsQ0FBQztPQUNKLENBQUM7T0FQSSxDQUFDOzs2QkFDc0MsU0FBUztHQU92RDtBQUNELFNBQU8sQ0FBQyxDQUFDO0NBQ1YsQ0FBQSxFQUFFLEFBQUMsQ0FBQzs7O0FBR1UsU0FBUyxNQUFNLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRTtBQUNqRCxTQUFPLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0NBQ25EIiwiZmlsZSI6InNyYy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTQgU2hhcGUgU2VjdXJpdHksIEluYy5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgTW9ub2lkYWxSZWR1Y2VyIGZyb20gXCIuL21vbm9pZGFsLXJlZHVjZXJcIlxuZXhwb3J0IHtNb25vaWRhbFJlZHVjZXJ9O1xuXG5cbmZ1bmN0aW9uIHJlY3Vyc2UoYnJhbmNoKSB7XG4gIHJldHVybiBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgbGV0IGJyYW5jaE5vZGUgPSBub2RlW2JyYW5jaF07XG4gICAgcmV0dXJuIERSSVZFUlticmFuY2hOb2RlLnR5cGVdKHJlZHVjZXIsIGJyYW5jaE5vZGUpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZWN1cnNlTWF5YmUoYnJhbmNoKSB7XG4gIHJldHVybiBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgbGV0IGJyYW5jaE5vZGUgPSBub2RlW2JyYW5jaF07XG4gICAgaWYgKGJyYW5jaE5vZGUgPT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIERSSVZFUlticmFuY2hOb2RlLnR5cGVdKHJlZHVjZXIsIGJyYW5jaE5vZGUpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZWN1cnNlTGlzdChicmFuY2gpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHJlZHVjZXIsIG5vZGUpIHtcbiAgICByZXR1cm4gW10ubWFwLmNhbGwobm9kZVticmFuY2hdLCAobikgPT4gRFJJVkVSW24udHlwZV0ocmVkdWNlciwgbikpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZWN1cnNlTGlzdE1heWJlKGJyYW5jaCkge1xuICByZXR1cm4gZnVuY3Rpb24ocmVkdWNlciwgbm9kZSkge1xuICAgIHJldHVybiBbXS5tYXAuY2FsbChub2RlW2JyYW5jaF0sIChuKSA9PiB7XG4gICAgICBpZiAobiA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICAgIHJldHVybiBEUklWRVJbbi50eXBlXShyZWR1Y2VyLCBuKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuY29uc3QgUkVEVUNFUl9TUEVDID0ge1xuICBBcnJheUV4cHJlc3Npb246IFtyZWN1cnNlTGlzdE1heWJlKCdlbGVtZW50cycpXSxcbiAgQXNzaWdubWVudEV4cHJlc3Npb246IFtyZWN1cnNlKCdiaW5kaW5nJyksIHJlY3Vyc2UoJ2V4cHJlc3Npb24nKV0sXG4gIEJpbmFyeUV4cHJlc3Npb246IFtyZWN1cnNlKCdsZWZ0JyksIHJlY3Vyc2UoJ3JpZ2h0JyldLFxuICBCbG9jazogW3JlY3Vyc2VMaXN0KCdzdGF0ZW1lbnRzJyldLFxuICBCbG9ja1N0YXRlbWVudDogW3JlY3Vyc2UoJ2Jsb2NrJyldLFxuICBCcmVha1N0YXRlbWVudDogW3JlY3Vyc2VNYXliZSgnbGFiZWwnKV0sXG4gIENhbGxFeHByZXNzaW9uOiBbcmVjdXJzZSgnY2FsbGVlJyksIHJlY3Vyc2VMaXN0KCdhcmd1bWVudHMnKV0sXG4gIENhdGNoQ2xhdXNlOiBbcmVjdXJzZSgnYmluZGluZycpLCByZWN1cnNlKCdib2R5JyldLFxuICBDb21wdXRlZE1lbWJlckV4cHJlc3Npb246IFtyZWN1cnNlKCdvYmplY3QnKSwgcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgQ29uZGl0aW9uYWxFeHByZXNzaW9uOiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdjb25zZXF1ZW50JyksIHJlY3Vyc2UoJ2FsdGVybmF0ZScpXSxcbiAgQ29udGludWVTdGF0ZW1lbnQ6IFtyZWN1cnNlTWF5YmUoJ2xhYmVsJyldLFxuICBEYXRhUHJvcGVydHk6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ2V4cHJlc3Npb24nKV0sXG4gIERlYnVnZ2VyU3RhdGVtZW50OiBbXSxcbiAgRG9XaGlsZVN0YXRlbWVudDogW3JlY3Vyc2UoJ2JvZHknKSwgcmVjdXJzZSgndGVzdCcpXSxcbiAgRW1wdHlTdGF0ZW1lbnQ6IFtdLFxuICBFeHByZXNzaW9uU3RhdGVtZW50OiBbcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgRm9ySW5TdGF0ZW1lbnQ6IFtyZWN1cnNlKCdsZWZ0JyksIHJlY3Vyc2UoJ3JpZ2h0JyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIEZvclN0YXRlbWVudDogW3JlY3Vyc2VNYXliZSgnaW5pdCcpLCByZWN1cnNlTWF5YmUoJ3Rlc3QnKSwgcmVjdXJzZU1heWJlKCd1cGRhdGUnKSwgcmVjdXJzZSgnYm9keScpXSxcbiAgRnVuY3Rpb25Cb2R5OiBbcmVjdXJzZUxpc3QoJ2RpcmVjdGl2ZXMnKSwgcmVjdXJzZUxpc3QoJ3N0YXRlbWVudHMnKV0sXG4gIEZ1bmN0aW9uRGVjbGFyYXRpb246IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2VMaXN0KCdwYXJhbWV0ZXJzJyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIEZ1bmN0aW9uRXhwcmVzc2lvbjogW3JlY3Vyc2VNYXliZSgnbmFtZScpLCByZWN1cnNlTGlzdCgncGFyYW1ldGVycycpLCByZWN1cnNlKCdib2R5JyldLFxuICBHZXR0ZXI6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIElkZW50aWZpZXI6IFtdLFxuICBJZGVudGlmaWVyRXhwcmVzc2lvbjogW3JlY3Vyc2UoJ2lkZW50aWZpZXInKV0sXG4gIElmU3RhdGVtZW50OiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdjb25zZXF1ZW50JyksIHJlY3Vyc2VNYXliZSgnYWx0ZXJuYXRlJyldLFxuICBMYWJlbGVkU3RhdGVtZW50OiBbcmVjdXJzZSgnbGFiZWwnKSwgcmVjdXJzZSgnYm9keScpXSxcbiAgTGl0ZXJhbEJvb2xlYW5FeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbE51bGxFeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbEluZmluaXR5RXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxOdW1lcmljRXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxSZWdFeHBFeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbFN0cmluZ0V4cHJlc3Npb246IFtdLFxuICBOZXdFeHByZXNzaW9uOiBbcmVjdXJzZSgnY2FsbGVlJyksIHJlY3Vyc2VMaXN0KCdhcmd1bWVudHMnKV0sXG4gIE9iamVjdEV4cHJlc3Npb246IFtyZWN1cnNlTGlzdCgncHJvcGVydGllcycpXSxcbiAgUG9zdGZpeEV4cHJlc3Npb246IFtyZWN1cnNlKCdvcGVyYW5kJyldLFxuICBQcmVmaXhFeHByZXNzaW9uOiBbcmVjdXJzZSgnb3BlcmFuZCcpXSxcbiAgUHJvcGVydHlOYW1lOiBbXSxcbiAgUmV0dXJuU3RhdGVtZW50OiBbcmVjdXJzZU1heWJlKCdleHByZXNzaW9uJyldLFxuICBTY3JpcHQ6IFtyZWN1cnNlKCdib2R5JyldLFxuICBTZXR0ZXI6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ3BhcmFtZXRlcicpLCByZWN1cnNlKCdib2R5JyldLFxuICBTdGF0aWNNZW1iZXJFeHByZXNzaW9uOiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ3Byb3BlcnR5JyldLFxuICBTd2l0Y2hDYXNlOiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlTGlzdCgnY29uc2VxdWVudCcpXSxcbiAgU3dpdGNoRGVmYXVsdDogW3JlY3Vyc2VMaXN0KCdjb25zZXF1ZW50JyldLFxuICBTd2l0Y2hTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdkaXNjcmltaW5hbnQnKSwgcmVjdXJzZUxpc3QoJ2Nhc2VzJyldLFxuICBTd2l0Y2hTdGF0ZW1lbnRXaXRoRGVmYXVsdDogW3JlY3Vyc2UoJ2Rpc2NyaW1pbmFudCcpLCByZWN1cnNlTGlzdCgncHJlRGVmYXVsdENhc2VzJyksIHJlY3Vyc2UoJ2RlZmF1bHRDYXNlJyksIHJlY3Vyc2VMaXN0KCdwb3N0RGVmYXVsdENhc2VzJyldLFxuICBUaGlzRXhwcmVzc2lvbjogW10sXG4gIFRocm93U3RhdGVtZW50OiBbcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgVHJ5Q2F0Y2hTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdib2R5JyksIHJlY3Vyc2UoJ2NhdGNoQ2xhdXNlJyldLFxuICBUcnlGaW5hbGx5U3RhdGVtZW50OiBbcmVjdXJzZSgnYm9keScpLCByZWN1cnNlTWF5YmUoJ2NhdGNoQ2xhdXNlJyksIHJlY3Vyc2UoJ2ZpbmFsaXplcicpXSxcbiAgVW5rbm93bkRpcmVjdGl2ZTogW10sXG4gIFVzZVN0cmljdERpcmVjdGl2ZTogW10sXG4gIFZhcmlhYmxlRGVjbGFyYXRpb246IFtyZWN1cnNlTGlzdCgnZGVjbGFyYXRvcnMnKV0sXG4gIFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQ6IFtyZWN1cnNlKCdkZWNsYXJhdGlvbicpXSxcbiAgVmFyaWFibGVEZWNsYXJhdG9yOiBbcmVjdXJzZSgnYmluZGluZycpLCByZWN1cnNlTWF5YmUoJ2luaXQnKV0sXG4gIFdoaWxlU3RhdGVtZW50OiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdib2R5JyldLFxuICBXaXRoU3RhdGVtZW50OiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ2JvZHknKV0sXG59O1xuXG5jb25zdCBEUklWRVIgPSAoZnVuY3Rpb24oKXtcbiAgdmFyIG8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBmb3IobGV0IFQgaW4gUkVEVUNFUl9TUEVDKSB7XG4gICAgaWYoIXt9Lmhhc093blByb3BlcnR5LmNhbGwoUkVEVUNFUl9TUEVDLCBUKSkgY29udGludWU7XG4gICAgbGV0IHJlZHVjaW5nRnVuY3Rpb25OYW1lID0gJ3JlZHVjZScgKyBUO1xuICAgIG9bVF0gPSBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgICByZXR1cm4gcmVkdWNlcltyZWR1Y2luZ0Z1bmN0aW9uTmFtZV0uYXBwbHkocmVkdWNlciwgW25vZGVdLmNvbmNhdChcbiAgICAgICAgUkVEVUNFUl9TUEVDW1RdLm1hcCgoZikgPT4gZihyZWR1Y2VyLCBub2RlKSlcbiAgICAgICkpO1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIG87XG59KCkpO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlZHVjZShyZWR1Y2VyLCByZWR1Y2libGUpIHtcbiAgcmV0dXJuIERSSVZFUltyZWR1Y2libGUudHlwZV0ocmVkdWNlciwgcmVkdWNpYmxlKTtcbn1cbiJdfQ==