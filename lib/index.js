"use strict";

var Shift = require("shift-ast");

var MonoidalReducer = require("./monoidal-reducer")["default"];
exports.MonoidalReducer = MonoidalReducer;



function recurse(branch) {
  return function (reducer, node) {
    var branchNode = node[branch];
    return DRIVER[branchNode.type](reducer, branchNode);
  };
}

function recurseMaybe(branch) {
  return function (reducer, node) {
    var branchNode = node[branch];
    if (branchNode == null) return null;
    return DRIVER[branchNode.type](reducer, branchNode);
  };
}

function recurseList(branch) {
  return function (reducer, node) {
    return [].map.call(node[branch], function (n) {
      return DRIVER[n.type](reducer, n);
    });
  };
}

function recurseListMaybe(branch) {
  return function (reducer, node) {
    return [].map.call(node[branch], function (n) {
      if (n == null) return null;
      return DRIVER[n.type](reducer, n);
    });
  };
}

var REDUCER_SPEC = {
  ArrayExpression: [recurseListMaybe("elements")],
  AssignmentExpression: [recurse("binding"), recurse("expression")],
  BinaryExpression: [recurse("left"), recurse("right")],
  Block: [recurseList("statements")],
  BlockStatement: [recurse("block")],
  BreakStatement: [recurseMaybe("label")],
  CallExpression: [recurse("callee"), recurseList("arguments")],
  CatchClause: [recurse("binding"), recurse("body")],
  ComputedMemberExpression: [recurse("object"), recurse("expression")],
  ConditionalExpression: [recurse("test"), recurse("consequent"), recurse("alternate")],
  ContinueStatement: [recurseMaybe("label")],
  DataProperty: [recurse("name"), recurse("expression")],
  DebuggerStatement: [],
  DoWhileStatement: [recurse("body"), recurse("test")],
  EmptyStatement: [],
  ExpressionStatement: [recurse("expression")],
  ForInStatement: [recurse("left"), recurse("right"), recurse("body")],
  ForStatement: [recurseMaybe("init"), recurseMaybe("test"), recurseMaybe("update"), recurse("body")],
  FunctionBody: [recurseList("directives"), recurseList("statements")],
  FunctionDeclaration: [recurse("name"), recurseList("parameters"), recurse("body")],
  FunctionExpression: [recurseMaybe("name"), recurseList("parameters"), recurse("body")],
  Getter: [recurse("name"), recurse("body")],
  Identifier: [],
  IdentifierExpression: [recurse("identifier")],
  IfStatement: [recurse("test"), recurse("consequent"), recurseMaybe("alternate")],
  LabeledStatement: [recurse("label"), recurse("body")],
  LiteralBooleanExpression: [],
  LiteralNullExpression: [],
  LiteralNumericExpression: [],
  LiteralRegExpExpression: [],
  LiteralStringExpression: [],
  NewExpression: [recurse("callee"), recurseList("arguments")],
  ObjectExpression: [recurseList("properties")],
  PostfixExpression: [recurse("operand")],
  PrefixExpression: [recurse("operand")],
  PropertyName: [],
  ReturnStatement: [recurseMaybe("expression")],
  Script: [recurse("body")],
  Setter: [recurse("name"), recurse("parameter"), recurse("body")],
  StaticMemberExpression: [recurse("object"), recurse("property")],
  SwitchCase: [recurse("test"), recurseList("consequent")],
  SwitchDefault: [recurseList("consequent")],
  SwitchStatement: [recurse("discriminant"), recurseList("cases")],
  SwitchStatementWithDefault: [recurse("discriminant"), recurseList("preDefaultCases"), recurse("defaultCase"), recurseList("postDefaultCases")],
  ThisExpression: [],
  ThrowStatement: [recurse("expression")],
  TryCatchStatement: [recurse("body"), recurse("catchClause")],
  TryFinallyStatement: [recurse("body"), recurseMaybe("catchClause"), recurse("finalizer")],
  UnknownDirective: [],
  UseStrictDirective: [],
  VariableDeclaration: [recurseList("declarators")],
  VariableDeclarationStatement: [recurse("declaration")],
  VariableDeclarator: [recurse("binding"), recurseMaybe("init")],
  WhileStatement: [recurse("test"), recurse("body")],
  WithStatement: [recurse("object"), recurse("body")] };

var DRIVER = (function () {
  var o = Object.create(null);
  _loop: for (var T in REDUCER_SPEC) {
    var _ret = (function (T) {
      if (!{}.hasOwnProperty.call(REDUCER_SPEC, T)) return "continue";
      var reducingFunctionName = "reduce" + T;
      o[T] = function (reducer, node) {
        return reducer[reducingFunctionName].apply(reducer, [node].concat(REDUCER_SPEC[T].map(function (f) {
          return f(reducer, node);
        })));
      };
    })(T);

    if (_ret === "continue") continue _loop;
  }
  return o;
}());


function reduce(reducer, reducible) {
  return DRIVER[reducible.type](reducer, reducible);
}
exports["default"] = reduce;
//# sourceMappingURL=data:application/json;base64,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S1IsQ0FBQztBQUpsQixVQUFHLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxFQUFFLGtCQUFTO0FBQ3RELFVBQUksb0JBQW9CLEdBQUcsUUFBUSxHQUFHLENBQUMsQ0FBQztBQUN4QyxPQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBUyxPQUFPLEVBQUUsSUFBSSxFQUFFO0FBQzdCLGVBQU8sT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FDL0QsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLENBQUM7aUJBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUM7U0FBQSxDQUFDLENBQzdDLENBQUMsQ0FBQztPQUNKLENBQUM7T0FGZSxDQUFDOzs7R0FHbkI7QUFDRCxTQUFPLENBQUMsQ0FBQztDQUNWLEVBQUUsQ0FBQyxDQUFDOzs7QUFHVSxTQUFTLE1BQU0sQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFO0FBQ2pELFNBQU8sTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7Q0FDbkQ7cUJBRnVCLE1BQU0iLCJmaWxlIjoic3JjL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAxNCBTaGFwZSBTZWN1cml0eSwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIilcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCAqIGFzIFNoaWZ0IGZyb20gXCJzaGlmdC1hc3RcIlxuaW1wb3J0IE1vbm9pZGFsUmVkdWNlciBmcm9tIFwiLi9tb25vaWRhbC1yZWR1Y2VyXCJcbmV4cG9ydCB7TW9ub2lkYWxSZWR1Y2VyfTtcblxuXG5mdW5jdGlvbiByZWN1cnNlKGJyYW5jaCkge1xuICByZXR1cm4gZnVuY3Rpb24ocmVkdWNlciwgbm9kZSkge1xuICAgIGxldCBicmFuY2hOb2RlID0gbm9kZVticmFuY2hdO1xuICAgIHJldHVybiBEUklWRVJbYnJhbmNoTm9kZS50eXBlXShyZWR1Y2VyLCBicmFuY2hOb2RlKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVjdXJzZU1heWJlKGJyYW5jaCkge1xuICByZXR1cm4gZnVuY3Rpb24ocmVkdWNlciwgbm9kZSkge1xuICAgIGxldCBicmFuY2hOb2RlID0gbm9kZVticmFuY2hdO1xuICAgIGlmIChicmFuY2hOb2RlID09IG51bGwpIHJldHVybiBudWxsO1xuICAgIHJldHVybiBEUklWRVJbYnJhbmNoTm9kZS50eXBlXShyZWR1Y2VyLCBicmFuY2hOb2RlKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVjdXJzZUxpc3QoYnJhbmNoKSB7XG4gIHJldHVybiBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgcmV0dXJuIFtdLm1hcC5jYWxsKG5vZGVbYnJhbmNoXSwgKG4pID0+IERSSVZFUltuLnR5cGVdKHJlZHVjZXIsIG4pKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVjdXJzZUxpc3RNYXliZShicmFuY2gpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHJlZHVjZXIsIG5vZGUpIHtcbiAgICByZXR1cm4gW10ubWFwLmNhbGwobm9kZVticmFuY2hdLCAobikgPT4ge1xuICAgICAgaWYgKG4gPT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gICAgICByZXR1cm4gRFJJVkVSW24udHlwZV0ocmVkdWNlciwgbik7XG4gICAgfSk7XG4gIH07XG59XG5cbmNvbnN0IFJFRFVDRVJfU1BFQyA9IHtcbiAgQXJyYXlFeHByZXNzaW9uOiBbcmVjdXJzZUxpc3RNYXliZSgnZWxlbWVudHMnKV0sXG4gIEFzc2lnbm1lbnRFeHByZXNzaW9uOiBbcmVjdXJzZSgnYmluZGluZycpLCByZWN1cnNlKCdleHByZXNzaW9uJyldLFxuICBCaW5hcnlFeHByZXNzaW9uOiBbcmVjdXJzZSgnbGVmdCcpLCByZWN1cnNlKCdyaWdodCcpXSxcbiAgQmxvY2s6IFtyZWN1cnNlTGlzdCgnc3RhdGVtZW50cycpXSxcbiAgQmxvY2tTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdibG9jaycpXSxcbiAgQnJlYWtTdGF0ZW1lbnQ6IFtyZWN1cnNlTWF5YmUoJ2xhYmVsJyldLFxuICBDYWxsRXhwcmVzc2lvbjogW3JlY3Vyc2UoJ2NhbGxlZScpLCByZWN1cnNlTGlzdCgnYXJndW1lbnRzJyldLFxuICBDYXRjaENsYXVzZTogW3JlY3Vyc2UoJ2JpbmRpbmcnKSwgcmVjdXJzZSgnYm9keScpXSxcbiAgQ29tcHV0ZWRNZW1iZXJFeHByZXNzaW9uOiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ2V4cHJlc3Npb24nKV0sXG4gIENvbmRpdGlvbmFsRXhwcmVzc2lvbjogW3JlY3Vyc2UoJ3Rlc3QnKSwgcmVjdXJzZSgnY29uc2VxdWVudCcpLCByZWN1cnNlKCdhbHRlcm5hdGUnKV0sXG4gIENvbnRpbnVlU3RhdGVtZW50OiBbcmVjdXJzZU1heWJlKCdsYWJlbCcpXSxcbiAgRGF0YVByb3BlcnR5OiBbcmVjdXJzZSgnbmFtZScpLCByZWN1cnNlKCdleHByZXNzaW9uJyldLFxuICBEZWJ1Z2dlclN0YXRlbWVudDogW10sXG4gIERvV2hpbGVTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdib2R5JyksIHJlY3Vyc2UoJ3Rlc3QnKV0sXG4gIEVtcHR5U3RhdGVtZW50OiBbXSxcbiAgRXhwcmVzc2lvblN0YXRlbWVudDogW3JlY3Vyc2UoJ2V4cHJlc3Npb24nKV0sXG4gIEZvckluU3RhdGVtZW50OiBbcmVjdXJzZSgnbGVmdCcpLCByZWN1cnNlKCdyaWdodCcpLCByZWN1cnNlKCdib2R5JyldLFxuICBGb3JTdGF0ZW1lbnQ6IFtyZWN1cnNlTWF5YmUoJ2luaXQnKSwgcmVjdXJzZU1heWJlKCd0ZXN0JyksIHJlY3Vyc2VNYXliZSgndXBkYXRlJyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIEZ1bmN0aW9uQm9keTogW3JlY3Vyc2VMaXN0KCdkaXJlY3RpdmVzJyksIHJlY3Vyc2VMaXN0KCdzdGF0ZW1lbnRzJyldLFxuICBGdW5jdGlvbkRlY2xhcmF0aW9uOiBbcmVjdXJzZSgnbmFtZScpLCByZWN1cnNlTGlzdCgncGFyYW1ldGVycycpLCByZWN1cnNlKCdib2R5JyldLFxuICBGdW5jdGlvbkV4cHJlc3Npb246IFtyZWN1cnNlTWF5YmUoJ25hbWUnKSwgcmVjdXJzZUxpc3QoJ3BhcmFtZXRlcnMnKSwgcmVjdXJzZSgnYm9keScpXSxcbiAgR2V0dGVyOiBbcmVjdXJzZSgnbmFtZScpLCByZWN1cnNlKCdib2R5JyldLFxuICBJZGVudGlmaWVyOiBbXSxcbiAgSWRlbnRpZmllckV4cHJlc3Npb246IFtyZWN1cnNlKCdpZGVudGlmaWVyJyldLFxuICBJZlN0YXRlbWVudDogW3JlY3Vyc2UoJ3Rlc3QnKSwgcmVjdXJzZSgnY29uc2VxdWVudCcpLCByZWN1cnNlTWF5YmUoJ2FsdGVybmF0ZScpXSxcbiAgTGFiZWxlZFN0YXRlbWVudDogW3JlY3Vyc2UoJ2xhYmVsJyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIExpdGVyYWxCb29sZWFuRXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxOdWxsRXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxOdW1lcmljRXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxSZWdFeHBFeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbFN0cmluZ0V4cHJlc3Npb246IFtdLFxuICBOZXdFeHByZXNzaW9uOiBbcmVjdXJzZSgnY2FsbGVlJyksIHJlY3Vyc2VMaXN0KCdhcmd1bWVudHMnKV0sXG4gIE9iamVjdEV4cHJlc3Npb246IFtyZWN1cnNlTGlzdCgncHJvcGVydGllcycpXSxcbiAgUG9zdGZpeEV4cHJlc3Npb246IFtyZWN1cnNlKCdvcGVyYW5kJyldLFxuICBQcmVmaXhFeHByZXNzaW9uOiBbcmVjdXJzZSgnb3BlcmFuZCcpXSxcbiAgUHJvcGVydHlOYW1lOiBbXSxcbiAgUmV0dXJuU3RhdGVtZW50OiBbcmVjdXJzZU1heWJlKCdleHByZXNzaW9uJyldLFxuICBTY3JpcHQ6IFtyZWN1cnNlKCdib2R5JyldLFxuICBTZXR0ZXI6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ3BhcmFtZXRlcicpLCByZWN1cnNlKCdib2R5JyldLFxuICBTdGF0aWNNZW1iZXJFeHByZXNzaW9uOiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ3Byb3BlcnR5JyldLFxuICBTd2l0Y2hDYXNlOiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlTGlzdCgnY29uc2VxdWVudCcpXSxcbiAgU3dpdGNoRGVmYXVsdDogW3JlY3Vyc2VMaXN0KCdjb25zZXF1ZW50JyldLFxuICBTd2l0Y2hTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdkaXNjcmltaW5hbnQnKSwgcmVjdXJzZUxpc3QoJ2Nhc2VzJyldLFxuICBTd2l0Y2hTdGF0ZW1lbnRXaXRoRGVmYXVsdDogW3JlY3Vyc2UoJ2Rpc2NyaW1pbmFudCcpLCByZWN1cnNlTGlzdCgncHJlRGVmYXVsdENhc2VzJyksIHJlY3Vyc2UoJ2RlZmF1bHRDYXNlJyksIHJlY3Vyc2VMaXN0KCdwb3N0RGVmYXVsdENhc2VzJyldLFxuICBUaGlzRXhwcmVzc2lvbjogW10sXG4gIFRocm93U3RhdGVtZW50OiBbcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgVHJ5Q2F0Y2hTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdib2R5JyksIHJlY3Vyc2UoJ2NhdGNoQ2xhdXNlJyldLFxuICBUcnlGaW5hbGx5U3RhdGVtZW50OiBbcmVjdXJzZSgnYm9keScpLCByZWN1cnNlTWF5YmUoJ2NhdGNoQ2xhdXNlJyksIHJlY3Vyc2UoJ2ZpbmFsaXplcicpXSxcbiAgVW5rbm93bkRpcmVjdGl2ZTogW10sXG4gIFVzZVN0cmljdERpcmVjdGl2ZTogW10sXG4gIFZhcmlhYmxlRGVjbGFyYXRpb246IFtyZWN1cnNlTGlzdCgnZGVjbGFyYXRvcnMnKV0sXG4gIFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQ6IFtyZWN1cnNlKCdkZWNsYXJhdGlvbicpXSxcbiAgVmFyaWFibGVEZWNsYXJhdG9yOiBbcmVjdXJzZSgnYmluZGluZycpLCByZWN1cnNlTWF5YmUoJ2luaXQnKV0sXG4gIFdoaWxlU3RhdGVtZW50OiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdib2R5JyldLFxuICBXaXRoU3RhdGVtZW50OiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ2JvZHknKV0sXG59O1xuXG5jb25zdCBEUklWRVIgPSAoZnVuY3Rpb24oKXtcbiAgdmFyIG8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBmb3IobGV0IFQgaW4gUkVEVUNFUl9TUEVDKSB7XG4gICAgaWYoIXt9Lmhhc093blByb3BlcnR5LmNhbGwoUkVEVUNFUl9TUEVDLCBUKSkgY29udGludWU7XG4gICAgbGV0IHJlZHVjaW5nRnVuY3Rpb25OYW1lID0gJ3JlZHVjZScgKyBUO1xuICAgIG9bVF0gPSBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgICByZXR1cm4gcmVkdWNlcltyZWR1Y2luZ0Z1bmN0aW9uTmFtZV0uYXBwbHkocmVkdWNlciwgW25vZGVdLmNvbmNhdChcbiAgICAgICAgUkVEVUNFUl9TUEVDW1RdLm1hcCgoZikgPT4gZihyZWR1Y2VyLCBub2RlKSlcbiAgICAgICkpO1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIG87XG59KCkpO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlZHVjZShyZWR1Y2VyLCByZWR1Y2libGUpIHtcbiAgcmV0dXJuIERSSVZFUltyZWR1Y2libGUudHlwZV0ocmVkdWNlciwgcmVkdWNpYmxlKTtcbn1cbiJdfQ==