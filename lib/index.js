"use strict";

var Shift = require("shift-ast");

var MonoidalReducer = require("./monoidal-reducer")["default"];
exports.MonoidalReducer = MonoidalReducer;



function recurse(branch) {
  return function (reducer, node) {
    var branchNode = node[branch];
    return DRIVER[branchNode.type](reducer, branchNode);
  };
}

function recurseMaybe(branch) {
  return function (reducer, node) {
    var branchNode = node[branch];
    if (branchNode == null) return null;
    return DRIVER[branchNode.type](reducer, branchNode);
  };
}

function recurseList(branch) {
  return function (reducer, node) {
    return [].map.call(node[branch], function (n) {
      return DRIVER[n.type](reducer, n);
    });
  };
}

function recurseListMaybe(branch) {
  return function (reducer, node) {
    return [].map.call(node[branch], function (n) {
      if (n == null) return null;
      return DRIVER[n.type](reducer, n);
    });
  };
}

var REDUCER_SPEC = {
  ArrayExpression: [recurseListMaybe("elements")],
  AssignmentExpression: [recurse("binding"), recurse("expression")],
  BinaryExpression: [recurse("left"), recurse("right")],
  Block: [recurseList("statements")],
  BlockStatement: [recurse("block")],
  BreakStatement: [recurseMaybe("label")],
  CallExpression: [recurse("callee"), recurseList("arguments")],
  CatchClause: [recurse("binding"), recurse("body")],
  ComputedMemberExpression: [recurse("object"), recurse("expression")],
  ConditionalExpression: [recurse("test"), recurse("consequent"), recurse("alternate")],
  ContinueStatement: [recurseMaybe("label")],
  DataProperty: [recurse("name"), recurse("expression")],
  DebuggerStatement: [],
  DoWhileStatement: [recurse("body"), recurse("test")],
  EmptyStatement: [],
  ExpressionStatement: [recurse("expression")],
  ForInStatement: [recurse("left"), recurse("right"), recurse("body")],
  ForStatement: [recurseMaybe("init"), recurseMaybe("test"), recurseMaybe("update"), recurse("body")],
  FunctionBody: [recurseList("directives"), recurseList("statements")],
  FunctionDeclaration: [recurse("name"), recurseList("parameters"), recurse("body")],
  FunctionExpression: [recurseMaybe("name"), recurseList("parameters"), recurse("body")],
  Getter: [recurse("name"), recurse("body")],
  Identifier: [],
  IdentifierExpression: [recurse("identifier")],
  IfStatement: [recurse("test"), recurse("consequent"), recurseMaybe("alternate")],
  LabeledStatement: [recurse("label"), recurse("body")],
  LiteralBooleanExpression: [],
  LiteralNullExpression: [],
  LiteralInfinityExpression: [],
  LiteralNumericExpression: [],
  LiteralRegExpExpression: [],
  LiteralStringExpression: [],
  NewExpression: [recurse("callee"), recurseList("arguments")],
  ObjectExpression: [recurseList("properties")],
  PostfixExpression: [recurse("operand")],
  PrefixExpression: [recurse("operand")],
  PropertyName: [],
  ReturnStatement: [recurseMaybe("expression")],
  Script: [recurse("body")],
  Setter: [recurse("name"), recurse("parameter"), recurse("body")],
  StaticMemberExpression: [recurse("object"), recurse("property")],
  SwitchCase: [recurse("test"), recurseList("consequent")],
  SwitchDefault: [recurseList("consequent")],
  SwitchStatement: [recurse("discriminant"), recurseList("cases")],
  SwitchStatementWithDefault: [recurse("discriminant"), recurseList("preDefaultCases"), recurse("defaultCase"), recurseList("postDefaultCases")],
  ThisExpression: [],
  ThrowStatement: [recurse("expression")],
  TryCatchStatement: [recurse("body"), recurse("catchClause")],
  TryFinallyStatement: [recurse("body"), recurseMaybe("catchClause"), recurse("finalizer")],
  UnknownDirective: [],
  UseStrictDirective: [],
  VariableDeclaration: [recurseList("declarators")],
  VariableDeclarationStatement: [recurse("declaration")],
  VariableDeclarator: [recurse("binding"), recurseMaybe("init")],
  WhileStatement: [recurse("test"), recurse("body")],
  WithStatement: [recurse("object"), recurse("body")] };

var DRIVER = (function () {
  var o = Object.create(null);
  _loop: for (var T in REDUCER_SPEC) {
    var _ret = (function (T) {
      if (!{}.hasOwnProperty.call(REDUCER_SPEC, T)) return "continue";
      var reducingFunctionName = "reduce" + T;
      o[T] = function (reducer, node) {
        return reducer[reducingFunctionName].apply(reducer, [node].concat(REDUCER_SPEC[T].map(function (f) {
          return f(reducer, node);
        })));
      };
    })(T);

    if (_ret === "continue") continue _loop;
  }
  return o;
}());


function reduce(reducer, reducible) {
  return DRIVER[reducible.type](reducer, reducible);
}
exports["default"] = reduce;
//# sourceMappingURL=data:application/json;base64,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Q0FBQyxJQUFJLFlBQVksRUFBRTswQkFLUixDQUFDO0FBSmxCLFVBQUcsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLEVBQUUsa0JBQVM7QUFDdEQsVUFBSSxvQkFBb0IsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQ3hDLE9BQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxVQUFTLE9BQU8sRUFBRSxJQUFJLEVBQUU7QUFDN0IsZUFBTyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUMvRCxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsQ0FBQztpQkFBSyxDQUFDLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQztTQUFBLENBQUMsQ0FDN0MsQ0FBQyxDQUFDO09BQ0osQ0FBQztPQUZlLENBQUM7OztHQUduQjtBQUNELFNBQU8sQ0FBQyxDQUFDO0NBQ1YsRUFBRSxDQUFDLENBQUM7OztBQUdVLFNBQVMsTUFBTSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUU7QUFDakQsU0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztDQUNuRDtxQkFGdUIsTUFBTSIsImZpbGUiOiJzcmMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAyMDE0IFNoYXBlIFNlY3VyaXR5LCBJbmMuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKVxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0ICogYXMgU2hpZnQgZnJvbSBcInNoaWZ0LWFzdFwiXG5pbXBvcnQgTW9ub2lkYWxSZWR1Y2VyIGZyb20gXCIuL21vbm9pZGFsLXJlZHVjZXJcIlxuZXhwb3J0IHtNb25vaWRhbFJlZHVjZXJ9O1xuXG5cbmZ1bmN0aW9uIHJlY3Vyc2UoYnJhbmNoKSB7XG4gIHJldHVybiBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgbGV0IGJyYW5jaE5vZGUgPSBub2RlW2JyYW5jaF07XG4gICAgcmV0dXJuIERSSVZFUlticmFuY2hOb2RlLnR5cGVdKHJlZHVjZXIsIGJyYW5jaE5vZGUpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZWN1cnNlTWF5YmUoYnJhbmNoKSB7XG4gIHJldHVybiBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgbGV0IGJyYW5jaE5vZGUgPSBub2RlW2JyYW5jaF07XG4gICAgaWYgKGJyYW5jaE5vZGUgPT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIERSSVZFUlticmFuY2hOb2RlLnR5cGVdKHJlZHVjZXIsIGJyYW5jaE5vZGUpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZWN1cnNlTGlzdChicmFuY2gpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHJlZHVjZXIsIG5vZGUpIHtcbiAgICByZXR1cm4gW10ubWFwLmNhbGwobm9kZVticmFuY2hdLCAobikgPT4gRFJJVkVSW24udHlwZV0ocmVkdWNlciwgbikpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZWN1cnNlTGlzdE1heWJlKGJyYW5jaCkge1xuICByZXR1cm4gZnVuY3Rpb24ocmVkdWNlciwgbm9kZSkge1xuICAgIHJldHVybiBbXS5tYXAuY2FsbChub2RlW2JyYW5jaF0sIChuKSA9PiB7XG4gICAgICBpZiAobiA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICAgIHJldHVybiBEUklWRVJbbi50eXBlXShyZWR1Y2VyLCBuKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuY29uc3QgUkVEVUNFUl9TUEVDID0ge1xuICBBcnJheUV4cHJlc3Npb246IFtyZWN1cnNlTGlzdE1heWJlKCdlbGVtZW50cycpXSxcbiAgQXNzaWdubWVudEV4cHJlc3Npb246IFtyZWN1cnNlKCdiaW5kaW5nJyksIHJlY3Vyc2UoJ2V4cHJlc3Npb24nKV0sXG4gIEJpbmFyeUV4cHJlc3Npb246IFtyZWN1cnNlKCdsZWZ0JyksIHJlY3Vyc2UoJ3JpZ2h0JyldLFxuICBCbG9jazogW3JlY3Vyc2VMaXN0KCdzdGF0ZW1lbnRzJyldLFxuICBCbG9ja1N0YXRlbWVudDogW3JlY3Vyc2UoJ2Jsb2NrJyldLFxuICBCcmVha1N0YXRlbWVudDogW3JlY3Vyc2VNYXliZSgnbGFiZWwnKV0sXG4gIENhbGxFeHByZXNzaW9uOiBbcmVjdXJzZSgnY2FsbGVlJyksIHJlY3Vyc2VMaXN0KCdhcmd1bWVudHMnKV0sXG4gIENhdGNoQ2xhdXNlOiBbcmVjdXJzZSgnYmluZGluZycpLCByZWN1cnNlKCdib2R5JyldLFxuICBDb21wdXRlZE1lbWJlckV4cHJlc3Npb246IFtyZWN1cnNlKCdvYmplY3QnKSwgcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgQ29uZGl0aW9uYWxFeHByZXNzaW9uOiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdjb25zZXF1ZW50JyksIHJlY3Vyc2UoJ2FsdGVybmF0ZScpXSxcbiAgQ29udGludWVTdGF0ZW1lbnQ6IFtyZWN1cnNlTWF5YmUoJ2xhYmVsJyldLFxuICBEYXRhUHJvcGVydHk6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ2V4cHJlc3Npb24nKV0sXG4gIERlYnVnZ2VyU3RhdGVtZW50OiBbXSxcbiAgRG9XaGlsZVN0YXRlbWVudDogW3JlY3Vyc2UoJ2JvZHknKSwgcmVjdXJzZSgndGVzdCcpXSxcbiAgRW1wdHlTdGF0ZW1lbnQ6IFtdLFxuICBFeHByZXNzaW9uU3RhdGVtZW50OiBbcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgRm9ySW5TdGF0ZW1lbnQ6IFtyZWN1cnNlKCdsZWZ0JyksIHJlY3Vyc2UoJ3JpZ2h0JyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIEZvclN0YXRlbWVudDogW3JlY3Vyc2VNYXliZSgnaW5pdCcpLCByZWN1cnNlTWF5YmUoJ3Rlc3QnKSwgcmVjdXJzZU1heWJlKCd1cGRhdGUnKSwgcmVjdXJzZSgnYm9keScpXSxcbiAgRnVuY3Rpb25Cb2R5OiBbcmVjdXJzZUxpc3QoJ2RpcmVjdGl2ZXMnKSwgcmVjdXJzZUxpc3QoJ3N0YXRlbWVudHMnKV0sXG4gIEZ1bmN0aW9uRGVjbGFyYXRpb246IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2VMaXN0KCdwYXJhbWV0ZXJzJyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIEZ1bmN0aW9uRXhwcmVzc2lvbjogW3JlY3Vyc2VNYXliZSgnbmFtZScpLCByZWN1cnNlTGlzdCgncGFyYW1ldGVycycpLCByZWN1cnNlKCdib2R5JyldLFxuICBHZXR0ZXI6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ2JvZHknKV0sXG4gIElkZW50aWZpZXI6IFtdLFxuICBJZGVudGlmaWVyRXhwcmVzc2lvbjogW3JlY3Vyc2UoJ2lkZW50aWZpZXInKV0sXG4gIElmU3RhdGVtZW50OiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdjb25zZXF1ZW50JyksIHJlY3Vyc2VNYXliZSgnYWx0ZXJuYXRlJyldLFxuICBMYWJlbGVkU3RhdGVtZW50OiBbcmVjdXJzZSgnbGFiZWwnKSwgcmVjdXJzZSgnYm9keScpXSxcbiAgTGl0ZXJhbEJvb2xlYW5FeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbE51bGxFeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbEluZmluaXR5RXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxOdW1lcmljRXhwcmVzc2lvbjogW10sXG4gIExpdGVyYWxSZWdFeHBFeHByZXNzaW9uOiBbXSxcbiAgTGl0ZXJhbFN0cmluZ0V4cHJlc3Npb246IFtdLFxuICBOZXdFeHByZXNzaW9uOiBbcmVjdXJzZSgnY2FsbGVlJyksIHJlY3Vyc2VMaXN0KCdhcmd1bWVudHMnKV0sXG4gIE9iamVjdEV4cHJlc3Npb246IFtyZWN1cnNlTGlzdCgncHJvcGVydGllcycpXSxcbiAgUG9zdGZpeEV4cHJlc3Npb246IFtyZWN1cnNlKCdvcGVyYW5kJyldLFxuICBQcmVmaXhFeHByZXNzaW9uOiBbcmVjdXJzZSgnb3BlcmFuZCcpXSxcbiAgUHJvcGVydHlOYW1lOiBbXSxcbiAgUmV0dXJuU3RhdGVtZW50OiBbcmVjdXJzZU1heWJlKCdleHByZXNzaW9uJyldLFxuICBTY3JpcHQ6IFtyZWN1cnNlKCdib2R5JyldLFxuICBTZXR0ZXI6IFtyZWN1cnNlKCduYW1lJyksIHJlY3Vyc2UoJ3BhcmFtZXRlcicpLCByZWN1cnNlKCdib2R5JyldLFxuICBTdGF0aWNNZW1iZXJFeHByZXNzaW9uOiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ3Byb3BlcnR5JyldLFxuICBTd2l0Y2hDYXNlOiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlTGlzdCgnY29uc2VxdWVudCcpXSxcbiAgU3dpdGNoRGVmYXVsdDogW3JlY3Vyc2VMaXN0KCdjb25zZXF1ZW50JyldLFxuICBTd2l0Y2hTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdkaXNjcmltaW5hbnQnKSwgcmVjdXJzZUxpc3QoJ2Nhc2VzJyldLFxuICBTd2l0Y2hTdGF0ZW1lbnRXaXRoRGVmYXVsdDogW3JlY3Vyc2UoJ2Rpc2NyaW1pbmFudCcpLCByZWN1cnNlTGlzdCgncHJlRGVmYXVsdENhc2VzJyksIHJlY3Vyc2UoJ2RlZmF1bHRDYXNlJyksIHJlY3Vyc2VMaXN0KCdwb3N0RGVmYXVsdENhc2VzJyldLFxuICBUaGlzRXhwcmVzc2lvbjogW10sXG4gIFRocm93U3RhdGVtZW50OiBbcmVjdXJzZSgnZXhwcmVzc2lvbicpXSxcbiAgVHJ5Q2F0Y2hTdGF0ZW1lbnQ6IFtyZWN1cnNlKCdib2R5JyksIHJlY3Vyc2UoJ2NhdGNoQ2xhdXNlJyldLFxuICBUcnlGaW5hbGx5U3RhdGVtZW50OiBbcmVjdXJzZSgnYm9keScpLCByZWN1cnNlTWF5YmUoJ2NhdGNoQ2xhdXNlJyksIHJlY3Vyc2UoJ2ZpbmFsaXplcicpXSxcbiAgVW5rbm93bkRpcmVjdGl2ZTogW10sXG4gIFVzZVN0cmljdERpcmVjdGl2ZTogW10sXG4gIFZhcmlhYmxlRGVjbGFyYXRpb246IFtyZWN1cnNlTGlzdCgnZGVjbGFyYXRvcnMnKV0sXG4gIFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQ6IFtyZWN1cnNlKCdkZWNsYXJhdGlvbicpXSxcbiAgVmFyaWFibGVEZWNsYXJhdG9yOiBbcmVjdXJzZSgnYmluZGluZycpLCByZWN1cnNlTWF5YmUoJ2luaXQnKV0sXG4gIFdoaWxlU3RhdGVtZW50OiBbcmVjdXJzZSgndGVzdCcpLCByZWN1cnNlKCdib2R5JyldLFxuICBXaXRoU3RhdGVtZW50OiBbcmVjdXJzZSgnb2JqZWN0JyksIHJlY3Vyc2UoJ2JvZHknKV0sXG59O1xuXG5jb25zdCBEUklWRVIgPSAoZnVuY3Rpb24oKXtcbiAgdmFyIG8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBmb3IobGV0IFQgaW4gUkVEVUNFUl9TUEVDKSB7XG4gICAgaWYoIXt9Lmhhc093blByb3BlcnR5LmNhbGwoUkVEVUNFUl9TUEVDLCBUKSkgY29udGludWU7XG4gICAgbGV0IHJlZHVjaW5nRnVuY3Rpb25OYW1lID0gJ3JlZHVjZScgKyBUO1xuICAgIG9bVF0gPSBmdW5jdGlvbihyZWR1Y2VyLCBub2RlKSB7XG4gICAgICByZXR1cm4gcmVkdWNlcltyZWR1Y2luZ0Z1bmN0aW9uTmFtZV0uYXBwbHkocmVkdWNlciwgW25vZGVdLmNvbmNhdChcbiAgICAgICAgUkVEVUNFUl9TUEVDW1RdLm1hcCgoZikgPT4gZihyZWR1Y2VyLCBub2RlKSlcbiAgICAgICkpO1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIG87XG59KCkpO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlZHVjZShyZWR1Y2VyLCByZWR1Y2libGUpIHtcbiAgcmV0dXJuIERSSVZFUltyZWR1Y2libGUudHlwZV0ocmVkdWNlciwgcmVkdWNpYmxlKTtcbn1cbiJdfQ==